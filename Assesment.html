<!DOCTYPE html>
<html lang="en">
<head>
    <title>Ayurcare - Prakriti Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .quiz-container { max-width: 700px; margin: auto; }
        .question-box { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: none; }
        .active { display: block; }
        .result-box { display: none; text-align: center; padding: 40px; }
    </style>
</head>
<body class="bg-light py-5">

<div class="container quiz-container">
    <div id="quiz">
        <h2 class="text-center mb-4">Prakriti Self-Assessment</h2>
        <div class="progress mb-4">
            <div id="progressBar" class="progress-bar bg-success" style="width: 0%"></div>
        </div>

        <div id="questionArea"></div>
    </div>

    <div id="result" class="card result-box shadow">
        <h2 class="text-success">Your Results</h2>
        <h3 id="dominantDosha" class="display-4 my-3"></h3>
        <p id="doshaDesc" class="lead text-muted"></p>
        <button onclick="location.reload()" class="btn btn-outline-success mt-4">Retake Test</button>
        <a href="./UserDashboard.html" class="btn btn-success mt-4">Back to Dashboard</a>
    </div>
</div>

<script>
    const questions = [
        {
            q: "How would you describe your body frame?",
            options: ["Thin, tall/short, bony", "Medium, athletic, fit", "Broad, large, heavy-set"],
            scores: ["Vata", "Pitta", "Kapha"]
        },
        {
            q: "How is your skin texture usually?",
            options: ["Dry, rough, thin", "Warm, reddish, sensitive", "Soft, oily, thick, cool"],
            scores: ["Vata", "Pitta", "Kapha"]
        },
        {
            q: "What are your digestion and appetite like?",
            options: ["Variable (sometimes hungry, sometimes not)", "Strong (intense hunger if meal is late)", "Slow (can skip meals easily)"],
            scores: ["Vata", "Pitta", "Kapha"]
        },
        {
            q: "How do you typically handle stress?",
            options: ["I become anxious and worried", "I become irritable or angry", "I remain calm and steady"],
            scores: ["Vata", "Pitta", "Kapha"]
        },
        {
            q: "How is your sleep pattern?",
            options: ["Light, easily disturbed", "Moderate but sound", "Deep, long, heavy"],
            scores: ["Vata", "Pitta", "Kapha"]
        }
    ];

    let currentIdx = 0;
    let userScores = { Vata: 0, Pitta: 0, Kapha: 0 };

    function showQuestion() {
        const area = document.getElementById("questionArea");
        const qData = questions[currentIdx];
        
        // Update Progress
        document.getElementById("progressBar").style.width = ((currentIdx) / questions.length * 100) + "%";

        area.innerHTML = `
            <div class="question-box active">
                <h5>Question ${currentIdx + 1} of ${questions.length}</h5>
                <h4 class="my-3">${qData.q}</h4>
                ${qData.options.map((opt, i) => `
                    <button class="btn btn-outline-dark w-100 text-start mb-2 p-3" onclick="handleAnswer('${qData.scores[i]}')">
                        ${opt}
                    </button>
                `).join('')}
            </div>
        `;
    }

    function handleAnswer(dosha) {
        userScores[dosha]++;
        currentIdx++;

        if (currentIdx < questions.length) {
            showQuestion();
        } else {
            showResult();
        }
    }

    function showResult() {
        document.getElementById("quiz").style.display = "none";
        document.getElementById("result").style.display = "block";

        // Find highest score
        const winner = Object.keys(userScores).reduce((a, b) => userScores[a] > userScores[b] ? a : b);
        
        const descriptions = {
            Vata: "You are energetic, creative, and fast-moving. You tend towards dryness and light sleep. Stay warm and grounded.",
            Pitta: "You are focused, sharp, and intense. You have strong digestion and a fiery personality. Stay cool and avoid overworking.",
            Kapha: "You are calm, stable, and nurturing. You have great stamina but may lean towards lethargy. Stay active and light."
        };

        document.getElementById("dominantDosha").innerText = winner + " Dominant";
        document.getElementById("doshaDesc").innerText = descriptions[winner];
        
        // Save result locally so the Dashboard can see it
        localStorage.setItem('prakriti_result', winner);
    }

    showQuestion();
</script>

</body>
</html>